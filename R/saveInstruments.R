#' Save and Load all instrument definitions
#' 
#' Saves (loads) the .instrument environment to (from) disk.
#' \code{loadInstruments} will add instrument definitions that were saved to
#' your .instrument environment
#' 
#' After you have defined some instruments, you can use \code{saveInstruments}
#' to save the entire .instrument environment to disk.
#' 
#' @aliases saveInstruments loadInstruments
#' @param file_name What to name the file (name of file that holds a
#' .instrument enviroment) Does not include file extension.
#' @param dir Directory of file (defaults to current working directory. ie. "")
#' @param extension File extension of file. default is RData
#' @param env What environment holds .instrument environment to be updated;
#' usually .GlobalEnv.
#' @return Called for side-effect
#' @author Garrett See
#' @seealso save, load load.instrument define_stocks, define_futures,
#' define_options (option_series.yahoo)
#' @examples
#' 
#' \dontrun{
#' stock("SPY","USD",1)
#' saveInstruments()
#' loadInstruments()
#' }
#' @export 
#' @rdname saveInstruments
saveInstruments <- function(file_name="MyInstruments", dir="", extension="RData") {
	if (!is.null(dir) && !dir == "" && substr(dir,nchar(dir),nchar(dir)) != "/")
		dir <- paste(dir,"/",sep="")
	.instrument <- get('.instrument', pos=.GlobalEnv)
	save(.instrument,file=paste(dir,file_name,".",extension,sep=""))	
}

#' @export
#' @rdname saveInstruments
loadInstruments <-function(file_name="MyInstruments", dir="", extension="RData", env=.GlobalEnv) {
	if (!is.null(dir) && !dir == "" && substr(dir,nchar(dir),nchar(dir)) != "/")
		dir <- paste(dir,"/",sep="")
    tmpenv <- new.env()
	load(paste(dir,file_name,".",extension,sep=""),envir=tmpenv)
    .instrument <- get(".instrument",pos=env)
    il <- ls(tmpenv$.instrument,all.names=TRUE)
    for (i in il) {
        .instrument[[i]] <- tmpenv$.instrument[[i]]
    }
    assign(".instrument",.instrument, pos=env)
}

